# ============================================================================
# TMUX CONFIGURATION - Arch Linux
# Gruvbox Dark Theme | Lightweight | Terminal-Only
# ============================================================================

# ----------------------------------------------------------------------------
# GENERAL SETTINGS
# ----------------------------------------------------------------------------

# Use 256 color terminal
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",*256col*:Tc"

# Enable mouse support
set -g mouse on

# Increase scrollback buffer
set -g history-limit 10000

# Start window and pane numbering at 1
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Reduce escape time for better vim experience
set -sg escape-time 0

# Increase display time for messages
set -g display-time 2000

# Enable focus events
set -g focus-events on

# ----------------------------------------------------------------------------
# KEY BINDINGS
# ----------------------------------------------------------------------------

# Change prefix to Ctrl-a (optional, comment out to keep Ctrl-b)
# unbind C-b
# set -g prefix C-a
# bind C-a send-prefix

# Reload configuration
bind r source-file ~/.config/tmux/tmux.conf \; display "Config reloaded!"

# Split panes with intuitive keys
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# Navigate panes with vim-style keys
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Resize panes with vim-style keys
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Create new session
bind C-c new-session

# Switch between sessions with prefix + s (tmux native)
# This works without freezing


bind C-j display-popup -E -w 80% -h 80% "\
  session=\$(tmux list-sessions -F '#{session_name}' | \
  fzf --reverse --header 'Select session:' --preview 'tmux list-windows -t {}'); \
  if [ -n \"\$session\" ]; then tmux switch-client -t \"\$session\"; fi"

# Alternative FZF session switcher (if popup doesn't work on your terminal)
# Uncomment this and comment out the above if you prefer
# bind C-j split-window -v "tmux list-sessions -F '#{session_name}' | fzf --reverse | xargs tmux switch-client -t"

# FZF keybinding searcher - search and view all tmux keybindings
bind C-k display-popup -E -w 80% -h 80% "\
    tmux list-keys | \
    fzf --reverse --header 'Search keybindings:' --preview 'echo {}' --preview-window up:3:wrap"

# Easy window navigation
bind -r C-h select-window -t :-
bind -r C-l select-window -t :+

# Copy mode with vim keybindings
setw -g mode-keys vi
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-selection-and-cancel
bind -T copy-mode-vi C-v send -X rectangle-toggle

# ----------------------------------------------------------------------------
# GRUVBOX DARK COLOR SCHEME
# ----------------------------------------------------------------------------

# Gruvbox color palette
# bg0: #282828, bg1: #3c3836, bg2: #504945
# fg0: #fbf1c7, fg1: #ebdbb2, fg2: #d5c4a1
# red: #cc241d, green: #98971a, yellow: #d79921
# blue: #458588, purple: #b16286, aqua: #689d6a
# orange: #d65d0e

# Status bar colors (transparent background)
set -g status-style "bg=default,fg=#ebdbb2"

# Window status colors
setw -g window-status-style "bg=default,fg=#d5c4a1"
setw -g window-status-current-style "bg=#504945,fg=#fbf1c7,bold"

# Window status format
setw -g window-status-format " #I:#W "
setw -g window-status-current-format " #I:#W "

# Pane border colors
set -g pane-border-style "fg=#504945"
set -g pane-active-border-style "fg=#98971a"

# Message colors
set -g message-style "bg=#504945,fg=#fbf1c7,bold"
set -g message-command-style "bg=#504945,fg=#fbf1c7"

# Copy mode colors
setw -g mode-style "bg=#504945,fg=#fbf1c7"

# ----------------------------------------------------------------------------
# STATUS BAR CONFIGURATION
# ----------------------------------------------------------------------------

# Enable status bar
set -g status on
set -g status-interval 5
set -g status-position bottom
set -g status-justify left

# Status bar length
set -g status-left-length 50
set -g status-right-length 100

# Left status: session name
set -g status-left "#[bg=#98971a,fg=#282828,bold] #S #[bg=default,fg=#98971a]"

# Right status: network, battery, date/time
set -g status-right "#[fg=#d79921]#[bg=#d79921,fg=#282828] ðŸ“¡ #(ip route get 1.1.1.1 2>/dev/null | grep -oP 'src \\K\\S+' || echo 'N/A') #[bg=default,fg=#d79921]#[fg=#b16286]#[bg=#b16286,fg=#282828] ðŸ”‹ #(cat /sys/class/power_supply/BAT*/capacity 2>/dev/null || echo 'N/A')% #[bg=default,fg=#b16286]#[fg=#458588]#[bg=#458588,fg=#282828] %H:%M %d-%b-%y "

# Alternative battery command for different systems
# If the above doesn't work, try: #(acpi -b | grep -oP '\\d+(?=%)')%

# ----------------------------------------------------------------------------
# ADDITIONAL TWEAKS
# ----------------------------------------------------------------------------

# Automatically set window title
setw -g automatic-rename on
set -g set-titles on

# Activity monitoring
setw -g monitor-activity on
set -g visual-activity off

# Don't rename windows automatically after manual rename
set -g allow-rename off

# ============================================================================
# USAGE NOTES
# ============================================================================
#
# KEY BINDINGS SUMMARY:
# - prefix + r          : Reload config
# - prefix + |          : Split horizontally
# - prefix + -          : Split vertically
# - prefix + h/j/k/l    : Navigate panes (vim-style)
# - prefix + H/J/K/L    : Resize panes
# - prefix + C-c        : Create new session
# - prefix + C-j        : FZF session switcher (popup)
# - prefix + C-k        : FZF keybinding searcher
# - prefix + s          : Native session list
# - prefix + [          : Enter copy mode
# - In copy mode: v to select, y to copy
#
# DEPENDENCIES:
# - fzf: for interactive session switching (install: sudo pacman -S fzf)
#
# BATTERY PATH:
# If battery doesn't show, check your battery path with:
#   ls /sys/class/power_supply/
# Common paths: BAT0, BAT1, or battery
#
# NETWORK:
# Shows the IP address of your active connection
# Displays "N/A" if no network is available
#
# ============================================================================
## ----------------------------------------------------------------------------
# TMUX PLUGINS
# ----------------------------------------------------------------------------
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-yank'

# tmux-resurrect key bindings:
#   Prefix + Ctrl-s â†’ Save session
#   Prefix + Ctrl-r â†’ Restore session

# tmux-continuum auto-save every 15 minutes
set -g @continuum-restore 'on'
set -g @continuum-save-interval '15'

# Initialize TPM (must be last)
run '~/.config/tmux/plugins/tpm/tpm'
